<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>P-Alert MVP - 体調記録</title>

<style>
body {
  font-family: sans-serif;
  max-width: 720px;
  margin: 24px auto;
  padding: 0 16px;
  background: linear-gradient(to bottom, #eef2ff, #f8fafc);
}

h1, h2 {
  margin-bottom: 16px;
}

/* ===== ヘッダー ===== */
.topbar {
  display:flex;
  justify-content: space-between;
  align-items:center;
  margin-bottom: 20px;
}

.nav-buttons {
  display: flex;
  gap: 10px;
}

.nav-btn {
  padding: 8px 14px;
  border-radius: 10px;
  background: #3b82f6;
  color: white !important;
  font-size: 14px;
  font-weight: bold;
  text-decoration: none;
}

.logout-btn {
  background: #ef4444;
}

/* ===== カード ===== */
.card {
  background: white;
  padding: 20px;
  border-radius: 18px;
  box-shadow: 0 8px 24px rgba(0,0,0,0.08);
  margin-bottom: 20px;
}

/* ===== スコア表示 ===== */
.score-display {
  font-size: 32px;
  font-weight: bold;
  text-align: center;
  margin: 16px 0;
  padding: 16px;
  border-radius: 16px;
  transition: 0.3s;
  color: white;
}

/* ===== スライダー ===== */
input[type="range"] {
  width: 100%;
  appearance: none;
  height: 8px;
  border-radius: 10px;
  outline: none;
  background: linear-gradient(to right, #60a5fa, #fbbf24, #ef4444);
}

input[type="range"]::-webkit-slider-thumb {
  appearance: none;
  width: 22px;
  height: 22px;
  border-radius: 50%;
  background: white;
  border: 3px solid #3b82f6;
  cursor: pointer;
}

.range-labels {
  display: flex;
  justify-content: space-between;
  font-size: 14px;
  margin-top: 6px;
}

/* ===== フォーム ===== */
textarea {
  width: 100%;
  padding: 10px;
  border-radius: 10px;
  border: 1px solid #ddd;
  font-size: 16px;
}

button {
  width: 100%;
  padding: 14px;
  border-radius: 12px;
  border: none;
  background: #3b82f6;
  color: white;
  font-size: 16px;
  font-weight: bold;
  margin-top: 16px;
  cursor: pointer;
}

button:hover {
  opacity: 0.9;
}

/* ===== 履歴横並び ===== */
.history-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.history-left {
  display: flex;
  gap: 12px;
  font-size: 15px;
}

.history-date {
  font-weight: 600;
}

.history-time {
  color: #666;
}

.score-badge {
  padding: 6px 14px;
  border-radius: 20px;
  font-weight: bold;
  color: white;
}

/* ===== フラッシュ ===== */
.flash {
  background:#fff7e6;
  padding:12px;
  border-radius:12px;
  margin-bottom:16px;
}
</style>
</head>

<body>

<!-- ===== ヘッダー ===== -->
<div class="topbar">
  <h1 style="margin:0;">P-Alert MVP</h1>
  <div class="nav-buttons">
    <a href="/" class="nav-btn">気圧へ</a>
    <a href="/logout" class="nav-btn logout-btn">ログアウト</a>
  </div>
</div>

<!-- ===== フラッシュ ===== -->
{% with messages = get_flashed_messages() %}
  {% if messages %}
    <div class="flash">
      {% for msg in messages %}
        <div>• {{ msg }}</div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}

<h2>体調記録 ~ずつうログ~</h2>

<div class="card">
<form method="post" action="/health">

  <div class="score-display" id="scoreLabel">中</div>

  <input type="range"
         name="score"
         min="1"
         max="5"
         step="1"
         value="3"
         oninput="updateScore(this.value)">

  <div class="range-labels">
    <span>弱</span>
    <span></span>
    <span>中</span>
    <span></span>
    <span>強</span>
  </div>

  <div style="margin-top:18px;">
    <textarea name="note" rows="3" placeholder="メモ（任意）"></textarea>
  </div>

  <button type="submit">記録する</button>

</form>
</div>

<h2>履歴（最新50件）</h2>

{% if logs %}
  {% for row in logs %}
    <div class="card history-row">

      <div class="history-left">
        <span class="history-date">
          {{ row["log_at"][:10] }}
        </span>
        <span class="history-time">
          {{ row["log_at"][11:16] }}
        </span>
      </div>

      <div>
        {% if row["score"] <= 2 %}
          <span class="score-badge" style="background:#60a5fa;">弱</span>
        {% elif row["score"] == 3 %}
          <span class="score-badge" style="background:#fbbf24;">中</span>
        {% else %}
          <span class="score-badge" style="background:#ef4444;">強</span>
        {% endif %}
      </div>

    </div>
  {% endfor %}
{% else %}
  <div class="card">まだ記録がありません。</div>
{% endif %}

<script>
function updateScore(val) {

  let labelText = "";
  let color = "";

  if (val <= 2) {
    labelText = "弱";
    color = "#60a5fa";
  } else if (val == 3) {
    labelText = "中";
    color = "#fbbf24";
  } else {
    labelText = "強";
    color = "#ef4444";
  }

  const label = document.getElementById("scoreLabel");
  label.innerText = labelText;
  label.style.background = color;
}

updateScore(3);
</script>

</body>
</html>